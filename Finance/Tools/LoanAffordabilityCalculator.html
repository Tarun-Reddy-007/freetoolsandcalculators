<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FreeOnlineCalculators</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8237022176069616" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="LoanAffordabilityCalculator.css" />
</head>
<body>
  <div class="layout-shell">
  <header class="top-banner"></header>
  <nav class="navbar">
    <div class="nav-links"><a href="../../index.html">FreeToolsandCalculators.com</a></div>
    <div class="nav-links" id="navLinks">
      <a href="../../index.html">Home</a>
      <a href="../../Health/Health.html">Health</a>
      <a href="../../Fitness/Fitness.html">Fitness</a>
      <a href="../../Sports/Sports.html">Sports</a>
      <a href="../../Clothing/Clothing.html">Clothing</a>
      <a href="../Finance.html">Finance</a>
      <a href="../../Utilities/Utilities.html">Utilities</a>
      <a href="../../Education/Education.html">Education</a>
      <a href="../../Media/Media.html">Media</a>
    </div>
    <div class="hamburger" onclick="toggleMenu()">&#9776;</div>
  </nav>

  <div class="content-row">
    <aside class="left-banner"></aside>
    <section class="scroll-panel">
      <div class="la-section">
      <div class="la-card">
        <div class="la-title-row">
          <h1 class="la-title">Loan Affordability Calculator</h1>
          <button type="button" class="la-info-trigger" aria-describedby="laInfoPanel" tabindex="0">i</button>
          <div id="laInfoPanel" class="la-info-flyout" role="tooltip" aria-hidden="true">
            <h2>How affordability is estimated</h2>
            <p>This tool estimates the maximum loan principal you can afford based on your income, obligations, desired Debt-To-Income (DTI) ratio and loan terms. It inverts the EMI formula to solve for principal.</p>
            <ul>
              <li>Monthly surplus = Net Income * (Target DTI %) - Existing EMIs</li>
              <li>EMI formula: EMI = P * r * (1+r)^n / ((1+r)^n - 1)</li>
              <li>Inversion yields: P = EMI * ((1+r)^n - 1)/(r*(1+r)^n)</li>
              <li>Property price = (Principal + Down Payment)</li>
            </ul>
            <p class="disclaimer">Approximate guidance only. Consult a financial advisor.</p>
          </div>
        </div>

        <div class="la-interaction-row">
          <form id="laForm" class="la-form" autocomplete="off">
            <div class="input-group">
              <label for="currency">Currency</label>
              <div class="input-row">
                <select id="currency" name="currency">
                  <option value="INR" selected>INR</option>
                  <option value="USD">USD</option>
                  <option value="EUR">EUR</option>
                  <option value="GBP">GBP</option>
                </select>
              </div>
            </div>
            <div class="input-group">
              <label for="netIncome">Monthly Net Income</label>
              <div class="input-row"><input type="number" id="netIncome" min="0" placeholder="e.g. 120000" required /></div>
            </div>
            <div class="input-group">
              <label for="existingEmi">Existing Monthly EMIs</label>
              <div class="input-row"><input type="number" id="existingEmi" min="0" value="0" /></div>
            </div>
            <div class="input-group">
              <label for="targetDti">Target DTI % (All debt vs income)</label>
              <div class="input-row"><input type="number" id="targetDti" min="5" max="90" value="40" required /></div>
              <div class="la-inline-buttons" data-group="dtiBtns">
                <button type="button" data-val="30">30%</button>
                <button type="button" data-val="35">35%</button>
                <button type="button" class="active" data-val="40">40%</button>
                <button type="button" data-val="45">45%</button>
                <button type="button" data-val="50">50%</button>
              </div>
            </div>
            <div class="input-group">
              <label for="rate">Annual Interest Rate (%)</label>
              <div class="input-row"><input type="number" id="rate" min="1" max="25" step="0.01" placeholder="e.g. 8.5" required /></div>
            </div>
            <div class="input-group">
              <label for="tenure">Tenure (Years)</label>
              <div class="input-row"><input type="number" id="tenure" min="1" max="40" value="20" required /></div>
              <div class="la-inline-buttons" data-group="tenureBtns">
                <button type="button" class="active" data-val="20">20y</button>
                <button type="button" data-val="25">25y</button>
                <button type="button" data-val="30">30y</button>
                <button type="button" data-val="15">15y</button>
              </div>
            </div>
            <div class="input-group">
              <label for="downPayment">Planned Down Payment</label>
              <div class="input-row"><input type="number" id="downPayment" min="0" value="0" /></div>
            </div>
            <div class="input-group">
              <label>Buffer / Stress Test</label>
              <div class="la-inline-buttons" data-group="bufferBtns">
                <button type="button" class="active" data-val="0">None</button>
                <button type="button" data-val="-5">-5% (Conservative)</button>
                <button type="button" data-val="-10">-10% (More Safe)</button>
                <button type="button" data-val="5">+5% Aggressive</button>
              </div>
              <div class="la-small-hint">Adjusts affordable principal by %</div>
            </div>
            <button type="submit" class="la-btn">Calculate Affordability</button>
          </form>

          <div id="laResultContainer" class="la-result-container">
            <div class="la-main-result">
              <span id="affordablePrincipal" class="la-main-value">--</span>
              <span class="la-main-label">Affordable Principal</span>
            </div>
            <div class="la-progress-wrapper">
              <div class="la-progress-bar"><div id="laProgress" class="la-progress"></div></div>
              <div class="la-scale"><span>Low</span><span>High</span></div>
            </div>
            <div class="la-breakdown" id="laBreakdown"></div>
            <div class="la-stats-grid" id="laStats"></div>
            <div class="la-tips" id="laTips"></div>
            <div class="la-disclaimer">Estimates only. Lenders use additional criteria.</div>
          </div>
        </div>
      </div>
      </div>
    </section>
  </div>

  <footer class="bottom-banner"></footer>
  </div>

  <script>
    function toggleMenu(){ document.getElementById('navLinks').classList.toggle('active'); }

    const form = document.getElementById('laForm');
    const resultContainer = document.getElementById('laResultContainer');
    const principalEl = document.getElementById('affordablePrincipal');
    const breakdownEl = document.getElementById('laBreakdown');
    const statsEl = document.getElementById('laStats');
    const tipsEl = document.getElementById('laTips');
    const progressEl = document.getElementById('laProgress');

    function currencySymbol(cur){ switch(cur){ case 'USD': return '$'; case 'EUR': return '€'; case 'GBP': return '£'; default: return '₹'; } }
    function fmtMoney(v, cur){ const sym = currencySymbol(cur); return sym + Number(v).toLocaleString(undefined,{maximumFractionDigits:0}); }

    function invertEmi(emi, annualRate, years){ const r = (annualRate/100)/12; const n = years*12; if(r===0) return emi * n; const pow = Math.pow(1+r, n); return emi * ( (pow - 1) / (r * pow) ); }
    function emiFromPrincipal(P, annualRate, years){ const r=(annualRate/100)/12; const n=years*12; if(r===0) return P/n; const pow=Math.pow(1+r,n); return P * r * pow / (pow - 1); }

    function setActive(groupAttr, btn){
      var selector = '[data-group="' + groupAttr + '"] button';
      document.querySelectorAll(selector).forEach(function(b){ b.classList.remove('active'); });
      btn.classList.add('active');
    }
    document.querySelectorAll('.la-inline-buttons').forEach(function(wrapper){
      wrapper.addEventListener('click', function(e){
        if(e.target && e.target.tagName === 'BUTTON'){
          setActive(wrapper.getAttribute('data-group'), e.target);
          var id = wrapper.getAttribute('data-group');
            if(id === 'dtiBtns'){ document.getElementById('targetDti').value = e.target.getAttribute('data-val'); }
            if(id === 'tenureBtns'){ document.getElementById('tenure').value = e.target.getAttribute('data-val'); }
            if(id === 'bufferBtns'){ /* handled separately but keeping consistency */ }
        }
      });
    });
    document.querySelectorAll('[data-group="bufferBtns"] button').forEach(function(btn){
      btn.addEventListener('click', function(){ setActive('bufferBtns', btn); });
    });

    form.addEventListener('submit', e=>{
      e.preventDefault();
      const currency = document.getElementById('currency').value;
      const income = parseFloat(document.getElementById('netIncome').value)||0;
      const existing = parseFloat(document.getElementById('existingEmi').value)||0;
      const targetDti = parseFloat(document.getElementById('targetDti').value)||0; // percent
      const rate = parseFloat(document.getElementById('rate').value)||0;
      const tenure = parseInt(document.getElementById('tenure').value,10)||0;
      const downPayment = parseFloat(document.getElementById('downPayment').value)||0;
      const bufferBtn = document.querySelector('[data-group="bufferBtns"] button.active');
      const bufferPct = bufferBtn ? parseFloat(bufferBtn.dataset.val) : 0;

      if(income<=0 || rate<=0 || tenure<=0 || targetDti<=0){ resultContainer.style.display='none'; resultContainer.classList.remove('show'); return; }

      // Maximum total debt service allowed
      const allowedTotalDebt = income * (targetDti/100);
      const maxNewEmi = Math.max(0, allowedTotalDebt - existing);
      if(maxNewEmi <= 0){ resultContainer.style.display='none'; resultContainer.classList.remove('show'); return; }

      // Invert EMI to get principal
      let basePrincipal = invertEmi(maxNewEmi, rate, tenure);
      // Apply buffer (negative reduces principal, positive increases)
      const adjustedPrincipal = basePrincipal * (1 + bufferPct/100);
      const principal = Math.max(0, adjustedPrincipal);
      const propertyPrice = principal + downPayment;

      // Recalculate EMI from adjusted principal (for clarity)
      const resultingEmi = emiFromPrincipal(principal, rate, tenure);
      const totalPaid = resultingEmi * tenure * 12;
      const interestTotal = totalPaid - principal;
      const effectiveDtiAfter = ( (existing + resultingEmi) / income ) * 100;

      principalEl.textContent = fmtMoney(principal, currency);

      // Progress heuristic (adjusted by currency typical scales)
  let scaleMax = 10000000; // 10 Million (INR) default
  if(currency==='USD' || currency==='EUR' || currency==='GBP') scaleMax = 2000000; // 2M
      const pct = Math.min(100, (principal/scaleMax)*100);
      progressEl.style.width = pct + '%';
      progressEl.style.background = pct < 33 ? '#2196f3' : pct < 66 ? '#4caf50' : '#ff9800';

      // Breakdown
      breakdownEl.innerHTML = '';
      const rows = [
        ['Monthly Income', fmtMoney(income, currency)],
        ['Existing EMIs', fmtMoney(existing, currency)],
        ['Allowed (DTI)', fmtMoney(allowedTotalDebt, currency)],
        ['Max New EMI', fmtMoney(maxNewEmi, currency)],
        ['Resulting EMI', fmtMoney(resultingEmi, currency)],
        ['Down Payment', fmtMoney(downPayment, currency)],
        ['Property Price', fmtMoney(propertyPrice, currency)]
      ];
      rows.forEach(r=>{ const div=document.createElement('div'); div.className='la-row'; div.innerHTML = `<span>${r[0]}</span><span>${r[1]}</span>`; breakdownEl.appendChild(div); });

      // Stats
      statsEl.innerHTML = '';
      const stats = [
        {lbl:'Total Interest', val: fmtMoney(interestTotal, currency)},
        {lbl:'Total Paid', val: fmtMoney(totalPaid, currency)},
        {lbl:'Eff. DTI %', val: effectiveDtiAfter.toFixed(1)+'%'},
        {lbl:'EMI / Income %', val: ((resultingEmi/income)*100).toFixed(1)+'%'},
        {lbl:'Tenure (mo)', val: (tenure*12)},
        {lbl:'Rate %', val: rate.toFixed(2)}
      ];
      stats.forEach(s=>{ const c=document.createElement('div'); c.className='la-stat'; c.innerHTML=`<span class="val">${s.val}</span><span class="lbl">${s.lbl}</span>`; statsEl.appendChild(c); });

      // Tips
      let tip = '';
      if(bufferPct < 0) tip += 'Conservative buffer reduces risk; you can remove it to see higher potential.';
      else if(bufferPct > 0) tip += 'Aggressive buffer increases exposure; keep emergency funds ready. ';
      if(effectiveDtiAfter > targetDti + 1) tip += ' Effective DTI slightly exceeds target due to rounding.';
      if(!tip) tip = 'Adjust DTI or tenure to see how affordability changes.';
      tipsEl.textContent = tip;

      resultContainer.style.display='flex';
      setTimeout(()=>{ resultContainer.classList.add('show'); resultContainer.scrollIntoView({behavior:'smooth', block:'center'}); },40);
    });
  </script>
</body>
</html>
